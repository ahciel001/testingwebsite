<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Link to CSS (Adjust ../ if you are in a deeper folder) -->
    <link rel="stylesheet" href="../style.css"> 
</head>

<body>
  <!-- Background Elements -->
  <div class="galaxy"></div>
  <canvas id="stars"></canvas>

  <!-- TOP NAVIGATION HEADER -->
  <header class="top-nav">
      <!-- Logo -->
      <a href="../index.html" class="nav-logo">
          The Starry Shore
      </a>

      <!-- Top Links -->
      <nav class="nav-links">
          <a href="../index.html">Home</a>
          <a href="../2014-server/shopping.html">2014 5e</a>
          <a href="#">2024 5.5e</a>
      </nav>

      <!-- Search Bar -->
      <div class="search-container">
          <input type="text" class="search-input" placeholder="Search...">
      </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="layout-container">
      
      <!-- SIDEBAR NAV -->
      <aside class="sidebar">
          <h2>Navigation</h2>
          <ul><li><strong>- 2014 5e Server</strong><ul><li><strong>- 2014 Server Systems</strong><ul><li><a href="- 2014 Server Systems/1. Shopping Guide.html">1. Shopping Guide</a></li><li><a href="- 2014 Server Systems/2. Crafting.html">2. Crafting</a></li><li><a href="- 2014 Server Systems/3. Item Patch Notes.html">3. Item Patch Notes</a></li><li><a href="- 2014 Server Systems/4. DownTime Points Guide (DTP).html">4. DownTime Points Guide (DTP)</a></li><li><a href="- 2014 Server Systems/5. Prestige Rules.html">5. Prestige Rules</a></li></ul></li><li><a href="1. About the Server.html">1. About the Server</a></li><li><a href="2. Character Creation Steps.html">2. Character Creation Steps</a></li><li><a href="3. How to Play.html">3. How to Play</a></li><li><a href="4. Loot and Items.html">4. Loot and Items</a></li><li><a href="5. Misc Rules.html">5. Misc Rules</a></li><li><a href="6. DM Guide.html">6. DM Guide</a></li><li><a href="7. DM Tools.html">7. DM Tools</a></li><li><strong>Events</strong><ul><li><a href="Events/3. Halloween feature.html">3. Halloween feature</a></li></ul></li></ul></li><li><strong>- 2024 5.5e Server</strong><ul><li><strong>- 2024 Server Systems</strong><ul><li><a href="../- 2024 5.5e Server/- 2024 Server Systems/2. Crafting.html">2. Crafting</a></li></ul></li><li><a href="../- 2024 5.5e Server/1. About the Server.html">1. About the Server</a></li><li><a href="../- 2024 5.5e Server/2. Character Creation Steps.html">2. Character Creation Steps</a></li><li><a href="../- 2024 5.5e Server/3. Creation Log Maker.html">3. Creation Log Maker</a></li><li><strong>Events</strong><ul><li><a href="../- 2024 5.5e Server/Events/3. Halloween feature.html">3. Halloween feature</a></li></ul></li></ul></li><li><a href="../index.html">index</a></li></ul>
      </aside>

      <!-- CONTENT AREA -->
      <main class="content">
          <h1>DM Tools</h1>
<style>
  /* --- STYLES FOR THE PILL BUTTONS ONLY --- */
  .pill-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px; /* Space between buttons */
    margin: 6px 0 12px 0;
  }

  .pill-label {
    cursor: pointer;
    user-select: none;
    margin: 0 !important; /* Overrides default label margin */
  }

  /* Hide the ugly default checkbox */
  .pill-label input {
    display: none; 
  }

  /* The visual button */
  .pill-span {
    display: block;
    padding: 8px 14px;
    background: #40424e; /* Matches your input background */
    border: 1px solid #555;
    border-radius: 20px; /* Round pill shape */
    font-size: 0.9em;
    transition: all 0.2s ease;
    color: #ccc;
    font-weight: 500;
  }

  /* Hover effect */
  .pill-label:hover .pill-span {
    border-color: #7289da;
    color: white;
  }

  /* Selected (Checked) State */
  .pill-label input:checked + .pill-span {
    background: #5865f2; /* Blurple color */
    border-color: #5865f2;
    color: white;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    transform: translateY(-1px);
  }
</style>

<!-- DM TOOLS CONTAINER -->
<div id="dm-tools-wrapper">

  <!-- HOST BUILDER SECTION -->
  <div style="width:100%; box-sizing:border-box; background-color:#323339; color:white; padding:1.5em; border-radius:10px; font-family:Inter, sans-serif;">
    <h2 style="text-align:center;">Looking to Host Builder</h2>

    <label><strong>Session name:</strong></label>
    <input id="sessionName" placeholder="*The Shattered Isles*" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>Description:</strong></label>
    <textarea id="description" placeholder="*A sea-bound adventure full of mystery and treasure...*" style="width:100%; height:80px; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <!-- Timestamp widget -->
    <div style="margin-bottom:12px; border:1px solid #555; border-radius:6px; padding:8px; background:#3b3d47; color:white;">
      <summary style="cursor:default; color:white; font-weight:600;">üïí Start Timestamp (auto)</summary>

      <div class="container" style="margin-top:8px;">
        <label><strong>Start Date (yyyy-mm-dd):</strong></label>
        <input type="date" id="ts_date" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

        <label><strong>Start Time (HH:MM):</strong></label>
        <input type="time" id="ts_time" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

        <select id="ts_type" style="display:none;">
          <option value="f">long date with short time</option>
        </select>

        <div style="display:none;">
          <span id="ts_preview"></span>
          <input type="text" readonly id="ts_code" title="Press Ctrl/Cmd+C to copy">
        </div>
      </div>
    </div>

    <label><strong>Expected duration (hrs):</strong></label>
    <input id="duration" type="text" placeholder="4" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>Expected APL:</strong></label>
    <!-- APL PILL BUTTONS -->
    <div class="pill-container">
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1153129945216852050>">
        <span class="pill-span">Starling (New Player)</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1068045032956891136>">
        <span class="pill-span">Tier 1</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1068045225253150850>">
        <span class="pill-span">Tier 2</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1068045384536039494>">
        <span class="pill-span">Tier 3</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1068045446938906624>">
        <span class="pill-span">Tier 4</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1068045526194475068>">
        <span class="pill-span">Tier 5</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="apl" value="<@&1130253701223817226>">
        <span class="pill-span">TRP Player</span>
      </label>
    </div>

    <!-- UPDATED: DIFFICULTY (LEFT) + PERMA DEATH (RIGHT) -->
    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 12px;">

      <!-- Difficulty Section -->
      <div style="flex: 1; min-width: 200px;">
        <label><strong>Difficulty:</strong></label>
        <div class="pill-container">
          <label class="pill-label"><input type="checkbox" class="difficulty" value="Trivial"><span class="pill-span">Trivial</span></label>
          <label class="pill-label"><input type="checkbox" class="difficulty" value="Easy"><span class="pill-span">Easy</span></label>
          <label class="pill-label"><input type="checkbox" class="difficulty" value="Medium"><span class="pill-span">Medium</span></label>
          <label class="pill-label"><input type="checkbox" class="difficulty" value="Hard"><span class="pill-span">Hard</span></label>
          <label class="pill-label"><input type="checkbox" class="difficulty" value="Deadly"><span class="pill-span">Deadly</span></label>
        </div>
      </div>

      <!-- Perma Death Section -->
      <div style="flex: 0 0 auto;">
        <label><strong>‚ò†Ô∏è Perma Death:</strong></label>
        <div style="margin-top: 6px;">
          <button id="permaDeath" style="background:#6b7280; border:none; color:white; padding:8px 16px; border-radius:6px; cursor:pointer;">Off</button>
        </div>
      </div>

    </div>

    <label><strong>Session Focus:</strong></label>
    <!-- SESSION FOCUS PILL BUTTONS -->
    <div class="pill-container">
      <label class="pill-label">
        <input type="checkbox" class="focus" value="Exploration">
        <span class="pill-span">Exploration</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="focus" value="Combat">
        <span class="pill-span">Combat</span>
      </label>
      <label class="pill-label">
        <input type="checkbox" class="focus" value="Roleplay">
        <span class="pill-span">Roleplay</span>
      </label>
    </div>

    <label><strong>House rules:</strong></label>
    <textarea id="houseRules" placeholder="*List any specific or homebrew rules for this session...*" style="width:100%; height:80px; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <!-- NEW FIELD: To Join -->
    <label><strong>To join:</strong></label>
    <textarea id="toJoin" placeholder="*Message me with character name, level...*" style="width:100%; height:40px; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <!-- NEW FIELD: Player Count -->
    <label><strong>Player count:</strong></label>
    <input id="hostPlayerCount" type="text" placeholder="5" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <div style="display:flex; justify-content:center; gap:8px;">
      <button onclick="generateMarkdown()" style="background:#5865f2; border:none; color:white; padding:8px 16px; border-radius:8px; cursor:pointer;">Generate</button>
      <button id="copyBtn" style="background:#43b581; border:none; color:white; padding:8px 16px; border-radius:8px; cursor:pointer;">Copy</button>
    </div>

    <textarea id="output" style="width:100%; height:280px; margin-top:14px; background:#40424e; color:white; border:none; border-radius:8px; padding:10px;" placeholder="Your formatted markdown will appear here..."></textarea>
  </div>

  <!-- SESSION LOG BUILDER SECTION -->
  <div style="width:100%; box-sizing:border-box; background-color:#323339; color:white; padding:1.5em; border-radius:10px; font-family:Inter, sans-serif; margin-top:24px;">
    <h2 style="text-align:center;">Session Log Builder</h2>

    <div style="display:flex; justify-content:flex-end; margin-bottom:12px;">
      <button onclick="importSessionInfo()" style="background:#f59e0b; border:none; color:white; padding:6px 14px; border-radius:6px; cursor:pointer;">Import From Host Builder</button>
    </div>

    <label><strong>Session Name:</strong></label>
    <input id="logSessionName" placeholder="*The Shattered Isles*" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>Player count (text):</strong></label>
    <input id="logPlayerCount" type="text" placeholder="5" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;" oninput="generateLogPlayerBoxes()">

    <label><strong>Players' names:</strong></label>
    <div id="logPlayerBoxes" style="margin-bottom:12px;"></div>

    <label><strong>Participants (alternative - paste names here):</strong></label>
    <textarea id="logParticipants" placeholder="- Player 1\n- Player 2" style="width:100%; height:80px; margin:8px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <label><strong>Date:</strong></label>
    <input id="logDate" placeholder="YYYY-MM-DD" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>Number of hours played:</strong></label>
    <input id="logHours" type="text" placeholder="4" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>APL (Average Player Level):</strong></label>
    <input id="logAPL" placeholder="Tier 2" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;">

    <label><strong>Player Loot:</strong></label>
    <textarea id="logLoot" placeholder="Gold" style="width:100%; margin:4px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <label><strong>Synopsis: (optional)</strong></label>
    <textarea id="logSynopsis" placeholder="*A brief overview of what happened...*" style="width:100%; height:80px; margin:8px 0 12px; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;"></textarea>

    <p style="margin-top:12px;"><strong>Anonymous Feedback (optional):</strong><br>
    <a href="https://forms.gle/56NGvHQw7QDeG9fj8" target="_blank" style="color:#8ab4f8;">https://forms.gle/56NGvHQw7QDeG9fj8</a></p>

    <div style="display:flex; justify-content:center; gap:8px;">
      <button onclick="generateSessionLog()" style="background:#5865f2; border:none; color:white; padding:8px 16px; border-radius:8px; cursor:pointer;">Generate</button>
      <button id="copyLogBtn" style="background:#43b581; border:none; color:white; padding:8px 16px; border-radius:8px; cursor:pointer;">Copy</button>
    </div>

    <textarea id="logOutput" style="width:100%; height:260px; margin-top:14px; background:#40424e; color:white; border:none; border-radius:8px; padding:10px;" placeholder="Your formatted session log will appear here..."></textarea>
  </div>

</div>

<!-- SCRIPTS -->
<script>
/* Perma death toggle */
function toggleButton(id) {
  const btn = document.getElementById(id);
  if (btn.textContent === "Off") {
    btn.textContent = "On";
    btn.style.background = "#43b581";
  } else {
    btn.textContent = "Off";
    btn.style.background = "#6b7280";
  }
}
document.getElementById("permaDeath").onclick = () => toggleButton("permaDeath");

/* ---------- Timestamp widget logic ---------- */
(function() {
  const dateInput = document.getElementById('ts_date');
  const timeInput = document.getElementById('ts_time');
  const typeInput = document.getElementById('ts_type'); // hidden
  const codeOutput = document.getElementById('ts_code');
  const preview = document.getElementById('ts_preview');

  function setNow() {
    const now = new Date();
    dateInput.value = now.getFullYear() + '-' + String(now.getMonth()+1).padStart(2,'0') + '-' + String(now.getDate()).padStart(2,'0');
    timeInput.value = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0');
    updateOutput();
  }

  function toLocalDateFromInputs() {
    if (!dateInput.value) return new Date();
    const [y, m, d] = dateInput.value.split('-').map(Number);
    let hours = 0, minutes = 0;
    if (timeInput.value) {
      [hours, minutes] = timeInput.value.split(':').map(Number);
    }
    return new Date(y, m - 1, d, hours, minutes, 0, 0);
  }

  function updateOutput() {
    const selectedDate = toLocalDateFromInputs();
    const tsSeconds = Math.floor(selectedDate.getTime() / 1000);
    const discordString = `<t:${tsSeconds}:f> - <t:${tsSeconds}:R>`;
    codeOutput.value = discordString;
    preview.textContent = selectedDate.toString();
    window.__dmtools_timestamp = discordString;
    window.__dmtools_timestamp_seconds = tsSeconds;
  }

  dateInput.addEventListener('change', updateOutput);
  timeInput.addEventListener('change', updateOutput);
  typeInput.addEventListener('change', updateOutput);

  setNow();
  window.dmtools_setTimestampNow = setNow;
})();

/* ---------- Host Builder ---------- */
function generateMarkdown() {
  const name = document.getElementById("sessionName").value || '';
  const desc = document.getElementById("description").value || '';
  const dur = document.getElementById("duration").value || '';

  // UPDATED: COLLECT MULTIPLE DIFFICULTIES
  const difficulty = [...document.querySelectorAll(".difficulty:checked")].map(c => c.value).join(", ");

  const permaDeath = document.getElementById("permaDeath").textContent;
  const houseRules = document.getElementById("houseRules").value || '';

  const toJoin = document.getElementById("toJoin").value || '';
  const playerCount = document.getElementById("hostPlayerCount").value || '';

  const apl = [...document.querySelectorAll(".apl:checked")].map(c => c.value).join(" ");
  const focus = [...document.querySelectorAll(".focus:checked")].map(c => c.value).join(", ");

  const discordTs = window.__dmtools_timestamp || '';

  const markdown = `**Session name:** ${name}

**Description:** ${desc}

**Start time:** ${discordTs}

**Expected duration:** ${dur}  
**Expected APL:** ${apl}  
**Difficulty:** ${difficulty}, Perma Death: ${permaDeath}  
**Session Focus:** ${focus}

**House rules:**  
${houseRules}

**Player count:** ${playerCount}
**To join:** ${toJoin}

**Players:**`;

  document.getElementById("output").value = markdown;
}

document.getElementById("copyBtn").onclick = async function() {
  const text = document.getElementById("output").value || '';
  try {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      await navigator.clipboard.writeText(text);
    } else {
      const ta = document.getElementById("output");
      ta.select();
      document.execCommand("copy");
    }
    this.textContent = "Copied!";
    setTimeout(() => this.textContent = "Copy", 1500);
  } catch (e) {
    alert("Copy failed: " + e);
  }
};

/* ---------- Session Log: dynamic player boxes ---------- */
function generateLogPlayerBoxes() {
  const countText = document.getElementById("logPlayerCount").value || '';
  const container = document.getElementById("logPlayerBoxes");
  container.innerHTML = "";

  const parsed = parseInt(countText, 10);
  if (!isFinite(parsed) || parsed <= 0) return;

  for (let i = 1; i <= parsed; i++) {
    const input = document.createElement("input");
    input.placeholder = `Player ${i}`;
    input.className = "logPlayerEntry";
    input.style = "width:100%; margin:4px 0; background:#40424e; color:white; border:none; border-radius:6px; padding:6px;";
    container.appendChild(input);
  }
}

/* ---------- Import From Host Builder ---------- */
function importSessionInfo() {
  document.getElementById("logSessionName").value = document.getElementById("sessionName").value || '';
  document.getElementById("logHours").value = document.getElementById("duration").value || '';

  // Also import the player count if available
  document.getElementById("logPlayerCount").value = document.getElementById("hostPlayerCount").value || '';

  // Import date in MM/DD/YYYY format
  const tsDate = document.getElementById("ts_date").value;
  if (tsDate) {
    const [y, m, d] = tsDate.split('-');
    document.getElementById("logDate").value = `${m}/${d}/${y}`;
  } else {
    document.getElementById("logDate").value = '';
  }

  // Trigger the box generation if player count was imported
  generateLogPlayerBoxes();
}

/* ---------- Generate Session Log markdown ---------- */
function generateSessionLog() {
  const name = document.getElementById("logSessionName").value || '';
  const date = document.getElementById("logDate").value || '';
  const hours = document.getElementById("logHours").value || '';
  const apl = document.getElementById("logAPL").value || '';
  const loot = document.getElementById("logLoot").value || '';
  const synopsis = document.getElementById("logSynopsis").value || '';

  const dynamicNames = [...document.querySelectorAll(".logPlayerEntry")]
    .map(p => p.value && p.value.trim() ? "- " + p.value.trim() : null)
    .filter(Boolean);

  let participantsList = '';
  if (dynamicNames.length > 0) {
    participantsList = dynamicNames.join("\n");
  } else {
    const textarea = document.getElementById("logParticipants").value || '';
    if (textarea.trim()) {
      participantsList = textarea.split(/\r?\n/).map(l => l.trim()).filter(Boolean).join("\n");
    } else {
      participantsList = "- (no participants entered)";
    }
  }

  const markdown = `**__Session Log:__**

**Session Name:** ${name}
**Participants:**  
${participantsList}

**Date:** ${date}
**Hours Played:** ${hours}
**APL:** ${apl}

**Player Loot:**  
${loot}

**Synopsis:**  
${synopsis}

**Anonymous Feedback Form:**  
<https://forms.gle/56NGvHQw7QDeG9fj8>`;

  document.getElementById("logOutput").value = markdown;
}

document.getElementById("copyLogBtn").onclick = async function() {
  const text = document.getElementById("logOutput").value || '';
  try {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      await navigator.clipboard.writeText(text);
    } else {
      const ta = document.getElementById("logOutput");
      ta.select();
      document.execCommand("copy");
    }
    this.textContent = "Copied!";
    setTimeout(() => this.textContent = "Copy", 1500);
  } catch (e) {
    alert("Copy failed: " + e);
  }
};

window.resetDmToolsTimestampToNow = function() {
  if (window.dmtools_setTimestampNow) window.dmtools_setTimestampNow();
};
</script>
      </main>
  </div>

  <!-- Link to JS -->
  <script src="../script.js"></script>
</body>
</html>
